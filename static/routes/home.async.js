webpackJsonp([1],{285:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=(a(68),a(67)),l=n(o),s=(a(151),a(150)),c=n(s),r=a(95),f=n(r),i=a(13),u=n(i),d=a(71),_=n(d),h=a(17),p=n(h),g=a(16),m=n(g),b=a(14),x=n(b),v=a(1),k=n(v),E=a(384),y=n(E),w=a(10),C=n(w),N=a(62),F=n(N),I=a(20),M=n(I),T=function(e){var t,a=e.className,n=e.onChangeHandle,o=e.sendHandle,l=e.children,s=e.text,c=e.title,r=(0,C.default)((t={},(0,x.default)(t,a,a||!1),(0,x.default)(t,y.default["chat-box"],!0),t));return k.default.createElement("div",{className:r},k.default.createElement(H,null,c),k.default.createElement(S,null,l),k.default.createElement(O,{onChangeHandle:n,sendHandle:o,value:s}))},P=k.default.PropTypes;T.propTypes={className:P.string};var H=function(e){var t=e.children,a=(0,C.default)((0,x.default)({},y.default["chat-title"],!0));return k.default.createElement("div",{className:a},t)},S=function(e){function t(e){(0,u.default)(this,t);var a=(0,p.default)(this,(t.__proto__||(0,f.default)(t)).call(this,e));return a.componentDidMount=function(){a.scrollChatPanelToBottom()},a.componentDidUpdate=function(){a.scrollChatPanelToBottom()},a.scrollChatPanelToBottom=function(){var e=M.default.findDOMNode(a.refs.chatPanel);setTimeout(function(){e.scrollTop=e.scrollHeight},0)},a.getNextMessageType=function(){var e=a.props.children;return 0==e.length?"right":e[e.length-1].props.type||"left"},a.chatPanel=null,a}return(0,m.default)(t,e),(0,_.default)(t,[{key:"render",value:function(){var e=(0,C.default)((0,x.default)({},y.default["chat-panel"],!0));return k.default.createElement(F.default,{className:e,type:this.getNextMessageType(),component:"div",ref:"chatPanel"},this.props.children)}}]),t}(k.default.Component),J=function(e){function t(e){return(0,u.default)(this,t),(0,p.default)(this,(t.__proto__||(0,f.default)(t)).call(this,e))}return(0,m.default)(t,e),(0,_.default)(t,[{key:"render",value:function(){var e,t=this.props,a=t.type,n=void 0===a?"left":a,o=t.children,l=(0,C.default)((0,x.default)({},y.default["chat-message"],!0)),s=(0,C.default)((e={},(0,x.default)(e,y.default["chat-message-content"],!0),(0,x.default)(e,y.default["chat-message-content-right"],"right"==n),(0,x.default)(e,y.default["chat-message-content-left"],"left"==n),e));return k.default.createElement("div",{className:l},k.default.createElement("p",{className:s},o," "))}}]),t}(k.default.Component),O=function(e){var t=e.onChangeHandle,a=e.sendHandle,n=e.value,o=(0,C.default)((0,x.default)({},y.default["chat-input-wrap"],!0));return k.default.createElement("div",{className:o},k.default.createElement(c.default,{type:"textarea",value:n,onChange:t,className:y.default["chat-input"],onPressEnter:a}),k.default.createElement(l.default,{className:y.default["chat-button"],onClick:a,size:"small"},"发送"))};T.ChatMessage=J,t.default=T,e.exports=t.default},291:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=(a(68),a(67)),l=n(o),s=(a(70),a(69)),c=n(s),r=a(94),f=n(r),i=a(95),u=n(i),d=a(13),_=n(d),h=a(71),p=n(h),g=a(17),m=n(g),b=a(16),x=n(b),v=a(1),k=n(v),E=a(79),y=(a(80),a(62)),w=n(y),C=a(387),N=n(C),F=a(285),I=n(F),M=a(153),T=I.default.ChatMessage,P=function(e){function t(e){(0,_.default)(this,t);var a=(0,m.default)(this,(t.__proto__||(0,u.default)(t)).call(this,e));return a.componentDidMount=function(){console.info("ddd"),a.linkToSocket()},a.componentWillUnmount=function(){a.socket.onclose=null,a.closeLink()},a.componentWillReceiveProps=function(e){},a.messageOnChange=function(e){a.setState({text:e.target.value})},a.sendMessage=function(e){var t=a.state,n=t.text,o=t.messages;""!=n&&(o.push({content:n,type:"right"}),a.socket.send((0,f.default)({operaCode:2,content:n})),setTimeout(function(){a.setState({text:"",messages:o})},0))},a.linkToSocket=function(){var e=new WebSocket(M.socketHost);a.socket=e;try{e.onopen=function(t){var n=a.props.log.loginData.userId;e.send((0,f.default)({operaCode:1,userId:n})),a.setState({isConnecting:!0}),c.default.info("连接成功",3)},e.onmessage=function(e){if("string"==typeof e.data){var t=a.state.messages,n=JSON.parse(e.data);3==n.responseCode&&(t.push({content:n.content,type:"left"}),a.setState({messages:t}))}else c.default.info("非文本消息",3)},e.onclose=function(){a.setState({isConnecting:!1}),c.default.warn("连接已关闭",3)}}catch(e){c.default.error(e,3)}window.onbeforeunload=function(){a.closeLink()}},a.closeLink=function(){var e=a.socket;try{e.close(),e=null}catch(e){new Error(e)}},a.state={text:"",isConnecting:!1,messages:[]},a}return(0,x.default)(t,e),(0,p.default)(t,[{key:"render",value:function(){var e=this.state,t=e.messages,a=e.isConnecting,n=this.props.log.loginData.addressList,o=n[n.length-1];return k.default.createElement(w.default,{duration:800,animConfig:{opacity:[1,0],translateY:[0,100]}},k.default.createElement("div",{className:N.default["app-home"],key:"home"},k.default.createElement("div",null,k.default.createElement("h1",null,"状态",a?"在线":"离线",k.default.createElement(l.default,{type:"primary",onClick:this.linkToSocket,disabled:a},"连接")),k.default.createElement("pre",{style:{float:"right"}},(0,f.default)(this.props.log.loginData.addressList,null,4))),k.default.createElement(I.default,{onChangeHandle:this.messageOnChange,sendHandle:this.sendMessage,text:this.state.text,title:"Chat with "+(o?o.userName:"= =")},t.map(function(e,t){return k.default.createElement(T,{type:e.type,key:"message"+t},e.content)}))))}}]),t}(k.default.Component),H=function(e){var t=e.log;e.message;return{loading:e.loading.models.log,log:t,message:c.default}};t.default=(0,E.connect)(H)(P),e.exports=t.default},355:function(e,t,a){t=e.exports=a(112)(),t.push([e.id,'.chat-box___36Ffp{display:inline-block;min-width:320px;min-height:440px;background-color:#f7f7f7;position:relative;border:1px solid #ccc;box-shadow:8px 8px 1px hsla(0,0%,80%,.8)}.chat-box___36Ffp .chat-title___vffIm{width:100%;height:30px;line-height:30px;text-indent:1em}.chat-box___36Ffp .chat-panel___2UOJC{width:100%;position:absolute;top:30px;left:0;bottom:20%;background-color:#fff;overflow-Y:scroll;overflow-X:hidden}.chat-box___36Ffp .chat-input-wrap___3fIh1{position:absolute;left:0;top:80%;bottom:0;right:0;background-color:#f7f7f7}.chat-box___36Ffp .chat-input-wrap___3fIh1 .chat-input___2fNR7{height:calc(100% - 25px);width:100%;resize:none;border:none;background-color:inherit;padding:10px}.chat-box___36Ffp .chat-input-wrap___3fIh1 .chat-input___2fNR7:focus,.chat-box___36Ffp .chat-input-wrap___3fIh1 .chat-input___2fNR7:hover{border-color:#ccc;outline:none;box-shadow:none}.chat-box___36Ffp .chat-input-wrap___3fIh1 .chat-button___3FMsW{float:right;margin-right:4px}.chat-box___36Ffp .chat-message___hIeE5{padding:10px;overflow:hidden}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content___18ZG9{color:#00a2ae;background:#cfedf0;border-color:#cfedf0;padding:5px 10px;position:relative;cursor:pointer;display:table-cell;max-width:60%;table-layout:fixed;word-wrap:break-word}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content___18ZG9:hover{background-color:rgba(207,237,240,.8)}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content___18ZG9:hover:before{border-bottom-color:rgba(207,237,240,.8)}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content-left___1nJpj{float:left;margin-left:10px}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content-right___18Y66{float:right;margin-right:10px}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content-left___1nJpj:before,.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content-right___18Y66:before{z-index:11;content:"";position:absolute;border:10px solid;border-top-color:transparent;border-bottom-color:#cfedf0;border-left-color:transparent;border-right-color:transparent;width:0;height:0;bottom:0}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content-left___1nJpj:before{left:-10px}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content-right___18Y66:before{right:-10px}',""]),t.locals={"chat-box":"chat-box___36Ffp","chat-title":"chat-title___vffIm","chat-panel":"chat-panel___2UOJC","chat-input-wrap":"chat-input-wrap___3fIh1","chat-input":"chat-input___2fNR7","chat-button":"chat-button___3FMsW","chat-message":"chat-message___hIeE5","chat-message-content":"chat-message-content___18ZG9","chat-message-content-left":"chat-message-content-left___1nJpj","chat-message-content-right":"chat-message-content-right___18Y66"}},357:function(e,t,a){t=e.exports=a(112)(),t.push([e.id,".app-home___3d9MN{background-color:#fff}",""]),t.locals={"app-home":"app-home___3d9MN"}},384:function(e,t,a){var n=a(355);"string"==typeof n&&(n=[[e.id,n,""]]);a(144)(n,{});n.locals&&(e.exports=n.locals)},387:function(e,t,a){var n=a(357);"string"==typeof n&&(n=[[e.id,n,""]]);a(144)(n,{});n.locals&&(e.exports=n.locals)}});