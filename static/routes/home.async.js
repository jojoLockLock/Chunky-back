webpackJsonp([1],{257:function(e,t,a){t=e.exports=a(60)(),t.push([e.id,'.chat-box___36Ffp{min-height:440px;width:100%;height:100%;background-color:#f7f7f7;position:relative;border:1px solid #f1f4f3;font-family:Microsoft YaHei,sans-serif}.chat-box___36Ffp .chat-title___vffIm{width:100%;height:30px;line-height:30px;text-indent:1em}.chat-box___36Ffp .chat-panel___2UOJC{width:100%;position:absolute;top:30px;left:0;bottom:20%;background-color:#fff;overflow-Y:scroll;overflow-X:hidden}.chat-box___36Ffp .chat-input-wrap___3fIh1{position:absolute;left:0;top:80%;bottom:0;right:0;background-color:#f7f7f7}.chat-box___36Ffp .chat-input-wrap___3fIh1 .chat-input___2fNR7{height:calc(100% - 25px);width:100%;resize:none;border:none;background-color:transparent;padding:10px}.chat-box___36Ffp .chat-input-wrap___3fIh1 .chat-input___2fNR7:focus,.chat-box___36Ffp .chat-input-wrap___3fIh1 .chat-input___2fNR7:hover{outline:none;box-shadow:none}.chat-box___36Ffp .chat-input-wrap___3fIh1 .chat-button___3FMsW{float:right;margin-right:4px}.chat-box___36Ffp .chat-message___hIeE5{padding:10px;overflow:hidden}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content___18ZG9{padding:5px 10px;position:relative;cursor:pointer;display:table-cell;max-width:60%;table-layout:fixed;word-wrap:break-word}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content-left___1nJpj{color:#919191;background:#e9e9e9;border-color:#e9e9e9;float:left;margin-left:10px;border-radius:0 10px 0 0}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content-right___18Y66{color:#00a2ae;background:#cfedf0;border-color:#cfedf0;float:right;margin-right:10px;border-radius:10px 0 0 0}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content-left___1nJpj:before,.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content-right___18Y66:before{z-index:11;position:absolute;width:0;height:0;bottom:0;border:10px solid transparent;content:""}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content-left___1nJpj:before{left:-10px;border-bottom-color:#e9e9e9}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content-right___18Y66:before{right:-10px;border-bottom-color:#cfedf0}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content-left___1nJpj:hover{background-color:hsla(0,0%,91%,.8)}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content-left___1nJpj:hover:before{border-bottom-color:hsla(0,0%,91%,.8)}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content-right___18Y66:hover{background-color:rgba(207,237,240,.8)}.chat-box___36Ffp .chat-message___hIeE5 .chat-message-content-right___18Y66:hover:before{border-bottom-color:rgba(207,237,240,.8)}',""]),t.locals={"chat-box":"chat-box___36Ffp","chat-title":"chat-title___vffIm","chat-panel":"chat-panel___2UOJC","chat-input-wrap":"chat-input-wrap___3fIh1","chat-input":"chat-input___2fNR7","chat-button":"chat-button___3FMsW","chat-message":"chat-message___hIeE5","chat-message-content":"chat-message-content___18ZG9","chat-message-content-left":"chat-message-content-left___1nJpj","chat-message-content-right":"chat-message-content-right___18Y66"}},259:function(e,t,a){t=e.exports=a(60)(),t.push([e.id,'.side-bar___pyzdK{padding:30px 0;width:100%;height:100%;background-color:#f7f7f7;border:1px solid hsla(0,0%,91%,.8);list-style:none}.side-bar-item___3y7Sh{cursor:pointer;text-indent:2em;padding:5px;position:relative;background:transparent}.side-bar-item___3y7Sh .item-content___2Dhao{position:relative;z-index:11;color:#919191}.side-bar___pyzdK .active___24oVN{position:relative;text-indent:2em;padding:5px;background:-webkit-linear-gradient(left,#fff 10px,transparent);background:linear-gradient(90deg,#fff 10px,transparent)}.side-bar___pyzdK .active___24oVN .item-content___2Dhao{color:#00a2ae}.side-bar___pyzdK .active___24oVN:before{z-index:10;content:"";position:absolute;top:0;bottom:0;left:0;width:6px;background:#00a2ae;opacity:.5}',""]),t.locals={"side-bar":"side-bar___pyzdK","side-bar-item":"side-bar-item___3y7Sh","item-content":"item-content___2Dhao",active:"active___24oVN"}},260:function(e,t,a){t=e.exports=a(60)(),t.push([e.id,"",""])},261:function(e,t,a){t=e.exports=a(60)(),t.push([e.id,".app-home___3d9MN{background-color:#fff}",""]),t.locals={"app-home":"app-home___3d9MN"}},278:function(e,t,a){var n=a(257);"string"==typeof n&&(n=[[e.id,n,""]]);a(59)(n,{});n.locals&&(e.exports=n.locals)},280:function(e,t,a){var n=a(259);"string"==typeof n&&(n=[[e.id,n,""]]);a(59)(n,{});n.locals&&(e.exports=n.locals)},282:function(e,t,a){var n=a(260);"string"==typeof n&&(n=[[e.id,n,""]]);a(59)(n,{});n.locals&&(e.exports=n.locals)},283:function(e,t,a){var n=a(261);"string"==typeof n&&(n=[[e.id,n,""]]);a(59)(n,{});n.locals&&(e.exports=n.locals)},517:function(e,t,a){"use strict";a(23),a(99)},532:517,575:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=(a(143),a(142)),c=n(o),r=(a(222),a(221)),s=n(r),l=a(75),i=n(l),u=a(10),d=n(u),f=a(41),_=n(f),h=a(16),p=n(h),g=a(15),m=n(g),v=a(11),b=n(v),y=a(1),x=n(y),k=a(278),w=n(k),E=a(9),C=n(E),N=a(34),A=n(N),M=a(18),I=n(M),F=function(e){var t,a=e.className,n=e.onChangeHandle,o=e.sendHandle,c=e.children,r=e.text,s=e.title,l=e.isAnimate,i=void 0===l||l,u=(0,C.default)((t={},(0,b.default)(t,a,a||!1),(0,b.default)(t,w.default["chat-box"],!0),t));return x.default.createElement("div",{className:u},x.default.createElement(T,null,s),x.default.createElement(P,{isAnimate:i},c),x.default.createElement(j,{onChangeHandle:n,sendHandle:o,value:r}))},O=x.default.PropTypes;F.propTypes={className:O.string,isAnimate:O.bool,onChangeHandle:O.func,sendHandle:O.func,text:O.string,title:O.oneOfType([O.string,O.node,O.element,O.number])};var T=function(e){var t=e.children,a=(0,C.default)((0,b.default)({},w.default["chat-title"],!0));return x.default.createElement("div",{className:a},t)},P=function(e){function t(e){(0,d.default)(this,t);var a=(0,p.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.componentDidMount=function(){a.scrollChatPanelToBottom()},a.componentDidUpdate=function(){a.scrollChatPanelToBottom()},a.scrollChatPanelToBottom=function(){var e=I.default.findDOMNode(a.refs.chatPanel);setTimeout(function(){e.scrollTop=e.scrollHeight},0)},a.getNextMessageType=function(){var e=a.props.children;return 0==e.length?"right":e[e.length-1].props.type||"left"},a.chatPanel=null,a}return(0,m.default)(t,e),(0,_.default)(t,[{key:"render",value:function(){var e=(0,C.default)((0,b.default)({},w.default["chat-panel"],!0)),t=this.props.isAnimate;return t?x.default.createElement(A.default,{className:e,type:this.getNextMessageType(),component:"div",duration:300,interval:0,onEnd:this.scrollChatPanelToBottom,ref:"chatPanel"},this.props.children):x.default.createElement("div",{className:e,type:this.getNextMessageType(),ref:"chatPanel"},this.props.children)}}]),t}(x.default.Component),S=function(e){function t(e){return(0,d.default)(this,t),(0,p.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e))}return(0,m.default)(t,e),(0,_.default)(t,[{key:"render",value:function(){var e,t=this.props,a=t.type,n=void 0===a?"left":a,o=t.children,c=(0,C.default)((0,b.default)({},w.default["chat-message"],!0)),r=(0,C.default)((e={},(0,b.default)(e,w.default["chat-message-content"],!0),(0,b.default)(e,w.default["chat-message-content-right"],"right"==n),(0,b.default)(e,w.default["chat-message-content-left"],"left"==n),e));return x.default.createElement("div",{className:c},x.default.createElement("p",{className:r},o," "))}}]),t}(x.default.Component),j=function(e){var t=e.onChangeHandle,a=e.sendHandle,n=e.value,o=(0,C.default)((0,b.default)({},w.default["chat-input-wrap"],!0));return x.default.createElement("div",{className:o},x.default.createElement(s.default,{type:"textarea",value:n,onChange:t,className:w.default["chat-input"],onPressEnter:a}),x.default.createElement(c.default,{className:w.default["chat-button"],type:"primary",onClick:a,size:"small"},"发送"))};F.ChatMessage=S,t.default=F,e.exports=t.default},577:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(11),c=n(o),r=a(6),s=n(r),l=a(1),i=n(l),u=a(280),d=n(u),f=a(9),_=n(f),h=a(34),p=(n(h),a(18)),g=(n(p),function(e){var t=e.children,a=e.activeKey;return i.default.createElement("ul",{className:d.default["side-bar"]},t.map(function(e,t){var n=e.props;return a.indexOf(e.key)!=-1&&(n=(0,s.default)({},n,{isActive:!0})),i.default.createElement(v,(0,s.default)({},n,{key:e.key}))}))}),m=i.default.PropTypes;g.propTypes={activeKey:m.arrayOf(m.string)};var v=function(e){var t,a=e.children,n=e.isActive,o=e.onClick,r=(0,_.default)((t={},(0,c.default)(t,d.default.active,n),(0,c.default)(t,d.default["side-bar-item"],!0),t));return i.default.createElement("li",{className:r,onClick:o},i.default.createElement("span",{className:d.default["item-content"]},a))};g.Item=v,t.default=g,e.exports=t.default},583:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=(a(532),a(223)),c=n(o),r=(a(517),a(216)),s=n(r),l=(a(73),a(72)),i=n(l),u=a(74),d=n(u),f=a(75),_=n(f),h=a(10),p=n(h),g=a(41),m=n(g),v=a(16),b=n(v),y=a(15),x=n(y),k=a(1),w=n(k),E=a(282),C=(n(E),a(9)),N=(n(C),a(34)),A=(n(N),a(18)),M=(n(A),a(147)),I=a(77),F=a(575),O=n(F),T=a(577),P=n(T),S=a(590),j=(n(S),a(62)),D=O.default.ChatMessage,H=P.default.Item,L=function(e){function t(e){(0,p.default)(this,t);var a=(0,b.default)(this,(t.__proto__||(0,_.default)(t)).call(this,e));return a.getChangeActiveChat=function(e){return function(){a.props.dispatch({type:"chat/setActiveChat",payload:{activeChat:e}}),a.getChatRecords(e.userAccount)}},a.getChatRecords=function(e){a.props.dispatch({type:"chat/getChatRecords",payload:{targetAccount:e}})},a.componentDidMount=function(){a.linkToSocket()},a.componentWillUnmount=function(){a.socket.onclose=null,a.closeLink()},a.componentWillReceiveProps=function(e){},a.shouldComponentUpdate=function(e){return e.log.isLogin},a.messageOnChange=function(e){a.setState({text:e.target.value})},a.sendMessage=function(e){var t=a.state,n=t.text,o=t.messages,c=t.isConnect;if(""!=n){if(c===!0){var r=a.props.log.loginData.userAccount,s=a.props.chat.activeChat.userAccount;a.props.dispatch({type:"chat/addChatRecords",payload:{targetAccount:s,message:{content:n,senderAccount:r}}}),a.socket.send((0,d.default)({type:"boardCast",content:n,targetAccount:s}))}else i.default.error("socket未连接",I.GLOBAL_MSG_DURATION);setTimeout(function(){a.setState({text:"",messages:o})},0)}},a.linkToSocket=function(){var e=new WebSocket(M.socketHost);a.socket=e;try{e.onopen=function(){var t=a.props.log.loginData,n=t.token,o=t.userAccount;e.send((0,d.default)({type:"auth",userAccount:o,token:n})),a.setState({isConnect:!0}),i.default.info("连接成功",3)},e.onmessage=function(e){a.props.log.loginData.userAccount;try{var t=JSON.parse(e.data),n=t.type;switch(n){case"newMessage":a.props.dispatch({type:"chat/addChatRecords",payload:{targetAccount:t.senderAccount,message:{content:t.content,senderAccount:t.senderAccount,date:(new Date).toString()}}});break;default:console.info(e.data)}}catch(e){i.default.error(e.message,3)}},e.onclose=function(){a.setState({isConnect:!1}),i.default.warn("连接已关闭",I.GLOBAL_MSG_DURATION)}}catch(e){i.default.error(e,3)}window.addEventListener?window.addEventListener("beforeunload",a.closeLink):window.attachEvent("onbeforeunload",a.closeLink)},a.closeLink=function(){var e=a.socket;try{e.close(),e=null}catch(e){new Error(e)}},a.state={text:"",isConnect:!1,messages:[]},a}return(0,x.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.log,n=t.chat,o=a.loginData.addressList,r=void 0===o?[]:o,l=n.activeChat,i=n.chatRecords,u=a.loginData.userAccount,d=i[l.userAccount]||[];return w.default.createElement(c.default,{style:{width:"500px"},className:"vertical-projection"},w.default.createElement(s.default,{span:6,style:{height:"500px"}},w.default.createElement(P.default,{activeKey:["address"+(l?l.userAccount:"nullActive")]},r.map(function(t){return w.default.createElement(H,{key:"address"+t.userAccount,onClick:e.getChangeActiveChat({userAccount:t.userAccount,userName:t.userName})},t.userName)}))),w.default.createElement(s.default,{span:18,style:{height:"500px"}},w.default.createElement(O.default,{onChangeHandle:this.messageOnChange,sendHandle:this.sendMessage,text:this.state.text,title:w.default.createElement("p",{style:{textAlign:"center"}},"Chat with "+(l?l.userName:""))},d.map(function(e,t){return w.default.createElement(D,{type:e.senderAccount==u?"right":"left",key:"message"+t},e.content)}))))}}]),t}(w.default.Component),R=function(e){var t=e.log,a=e.chat;return{loading:e.loading.models.log,log:t,chat:a}};t.default=(0,j.connect)(R)(L),e.exports=t.default},584:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(75),c=n(o),r=a(10),s=n(r),l=a(41),i=n(l),u=a(16),d=n(u),f=a(15),_=n(f),h=a(1),p=n(h),g=a(62),m=(a(79),a(34)),v=n(m),b=a(283),y=n(b),x=a(583),k=n(x),w=function(e){function t(e){return(0,s.default)(this,t),(0,d.default)(this,(t.__proto__||(0,c.default)(t)).call(this,e))}return(0,_.default)(t,e),(0,i.default)(t,[{key:"render",value:function(){return p.default.createElement(v.default,{duration:800,animConfig:{opacity:[1,0],translateY:[0,100]}},p.default.createElement("div",{className:y.default["app-home"],key:"home"},p.default.createElement(k.default,null)))}}]),t}(p.default.Component);t.default=(0,g.connect)()(w),e.exports=t.default},590:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(6),c=n(o),r=a(74),s=n(r),l=a(42),i=n(l),u=a(145),d=n(u),f=a(241),_=n(f),h=a(10),p=n(h),g=a(41),m=n(g),v=function(){function e(t){(0,p.default)(this,e),this.socketHost=t,this.socket=null,this.isConncet=!1,this.controllers={}}return(0,m.default)(e,[{key:"init",value:function(){var e=this;this.socket.onmessage=function(t){try{var a=JSON.parse(t.data),n=e.controllers;n[a.type]&&n[a.type](a)}catch(e){console.info(e)}}}},{key:"link",value:function(){var e=this;return new _.default(function(t,a){var n=e.socketHost;if(e.isConncet)a(new Error("socket have link in "+n));else{var o=new WebSocket(n);e.socket=o,o.onopen=function(){e.isConncet=!0,e.init(),t(e),window.addEventListener?window.addEventListener("beforeunload",e.close):window.attachEvent("onbeforeunload",e.close)}}})}},{key:"close",value:function(){var e=this;return new _.default(function(t,a){e.isConncet||t(new Error("socket have not linking"));var n=e.socket;try{n.close(),n=null,e.isConncet=!1,t()}catch(e){a(e)}})}},{key:"send",value:function(e,t){var a=this;return new _.default(function(n,o){console.info(a.isConncet),a.isConncet||o(new Error("socket have not linking")),(0,d.default)("undefined"==typeof e?"undefined":(0,i.default)(e),"string")||o(new Error("type must a string")),(0,d.default)("undefined"==typeof t?"undefined":(0,i.default)(t),"object")||o(new Error("payload must a object")),a.socket.send((0,s.default)((0,c.default)({type:e},t)))})}},{key:"addController",value:function(e,t){if(!(0,d.default)("undefined"==typeof e?"undefined":(0,i.default)(e),"string"))throw new Error("type must a string");if(!(0,d.default)("undefined"==typeof t?"undefined":(0,i.default)(t),"function"))throw new Error("controller must a object");this.controllers[e]=t}}]),e}();t.default=v,e.exports=t.default}});